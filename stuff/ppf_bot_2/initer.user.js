// ==UserScript==
// @name         PPF Dark bot
// @version      2.2
// @description  Have fun
// @author       Darkness
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @require      https://raw.githubusercontent.com/mitchellmebane/GM_fetch/master/GM_fetch.min.js
// @require      https://raw.githubusercontent.com/TouchedByDarkness/PixelPlanet-Bot/master/b64.js
// @connect      githubusercontent.com
// @connect      github.com
// @connect      glitch.me
// @connect      pixelplanet.fun
// @connect      fuckyouarkeros.fun
// @downloadURL  https://touchedbydarkness.github.io/stuff/ppf_bot_2/initer.user.js
// @updateURL  	 https://touchedbydarkness.github.io/stuff/ppf_bot_2/initer.user.js
// @match        *://fuckyouarkeros.fun/*
// @match        *://pixelplanet.fun/*
// ==/UserScript==

function payload(){"use strict";(()=>{function t(t,e,r){let n=new ArrayBuffer(3+4*r.length),i=new DataView(n);i.setUint8(0,145),i.setUint8(1,t),i.setUint8(2,e);let s=2,o=r.length;for(;o;){o-=1;let[t,e]=r[o];i.setUint8(s+=1,t>>>16),i.setUint16(s+=1,65535&t),i.setUint8(s+=2,e)}return n}function e(t,e){let r={};return e.forEach((e=>{let n=t.get(e[0],e[1]),i=r[n];i||(i=[],r[n]=i),i.push(e)})),r}function r(t){let e=0,r=0;return t.forEach((t=>{e+=t[0],r+=t[1]})),[Math.trunc(e/t.length),Math.trunc(r/t.length)]}function n(t){if(t.length<5)return W(t);let e=(t,e)=>I(t[0]-e[0])+I(t[1]-e[1]);for(let r=0;r!==t.length-1;r++){let n=t[r],i=r+1,s=e(n,t[i]);for(let o=r+2;o!==t.length;o++){let r=e(n,t[o]);r<s&&(s=r,i=o)}F(t,r+1,i)}return t}function i(){WebSocket.prototype.send=()=>{}}async function s(){let t=await Tt.get();if(t)switch(t.status){case 2:t.stop();break;case 0:h(t.start())}}function o(...t){console.debug("[DB]",...t.map((t=>"object"==typeof t&&t.hasOwnProperty("toString")?t.toString():t)))}async function a(){if(await Et.clear(),Tt.ready){let t=await Et.get(),e=Tt.now();if(!e||!t){let r=[];return e||r.push("bot"),t||r.push("targeter"),void o("cant change targeter because "+r.join(" and ")+" is missing")}await l(),e.changeTargeter(t)}else await l()}async function l(){let[t,e]=await Promise.all([Ct.get(),St.get()]);if(!t||!e){let r=[];return t||r.push("api"),e||r.push("template"),void o("cant change workspace because "+r.join(" and ")+" is missing")}let r=!1,n=Tt.now();n&&0!==n.status&&(r=!0,await n.stop());let i=t.createWorkspace(...e.toArray());t.hasWorkspace(i)||await t.changeWorkspace(i),r&&(n=Tt.now(),n&&h(n.start()))}function h(t){return kt.setBotStatus("works"),t.then((t=>{t?(o("error returned",t),ot.emit(8,t)):kt.setBotStatus("idle")}))}var c,u,d,p,f,g,m,w,y,b,v,x,P,k,T,E,S,C,A,M,O,I,_,j,L,D,W,F,N,R,U,$,z,B,H,q,Y,G,Q,K,V,X,Z,J,tt,et,rt,nt,it,st,ot,at,lt,ht,ct,ut,dt,pt,ft,gt,mt,wt,yt,bt,vt,xt,Pt,kt,Tt,Et,St,Ct,At,Mt=Object.create,Ot=Object.defineProperty,It=Object.getOwnPropertyDescriptor,_t=Object.getOwnPropertyNames,jt=Object.getPrototypeOf,Lt=Object.prototype.hasOwnProperty,Dt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Wt=(t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of _t(e))!Lt.call(t,i)&&i!==r&&Ot(t,i,{get:()=>e[i],enumerable:!(n=It(e,i))||n.enumerable});return t},Ft=(t,e,r)=>(r=null!=t?Mt(jt(t)):{},Wt(!e&&t&&t.__esModule?r:Ot(r,"default",{value:t,enumerable:!0}),t)),Nt=Dt(((t,e)=>{function r(){r.init.call(this)}function n(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function i(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function s(t,e,r,s){var o,a,l,h;return n(r),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),a=t._events),l=a[e]),void 0===l?(l=a[e]=r,++t._eventsCount):("function"==typeof l?l=a[e]=s?[r,l]:[l,r]:s?l.unshift(r):l.push(r),(o=i(t))>0&&l.length>o&&!l.warned&&(l.warned=!0,(h=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=l.length,function(t){console&&console.warn&&console.warn(t)}(h))),t}function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function a(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=o.bind(n);return i.listener=r,n.wrapFn=i,i}function l(t,e,r){var n,i=t._events;return void 0===i||void 0===(n=i[e])?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(n):c(n,n.length)}function h(t){var e,r=this._events;if(void 0!==r){if("function"==typeof(e=r[t]))return 1;if(void 0!==e)return e.length}return 0}function c(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function u(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){n.once&&t.removeEventListener(e,i),r(s)}))}}var d,p,f,g="object"==typeof Reflect?Reflect:null,m=g&&"function"==typeof g.apply?g.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};d=g&&"function"==typeof g.ownKeys?g.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)},p=Number.isNaN||function(t){return t!=t},e.exports=r,e.exports.once=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,s),n(r)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}u(t,e,s,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&u(t,"error",e,r)}(t,i,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0,f=10,Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");f=t}}),r.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return i(this)},r.prototype.emit=function(t){var e,r,n,i,s,o,a,l,h;for(e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);if(n="error"===t,void 0!==(i=this._events))n=n&&void 0===i.error;else if(!n)return!1;if(n){if(e.length>0&&(s=e[0]),s instanceof Error)throw s;throw(o=new Error("Unhandled error."+(s?" ("+s.message+")":""))).context=s,o}if(void 0===(a=i[t]))return!1;if("function"==typeof a)m(a,this,e);else for(h=c(a,l=a.length),r=0;r<l;++r)m(h[r],this,e);return!0},r.prototype.addListener=function(t,e){return s(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return s(this,t,e,!0)},r.prototype.once=function(t,e){return n(e),this.on(t,a(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){return n(e),this.prependListener(t,a(this,t,e)),this},r.prototype.removeListener=function(t,e){var r,i,s,o,a;if(n(e),void 0===(i=this._events))return this;if(void 0===(r=i[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,s=o;break}if(s<0)return this;0===s?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,s),1===r.length&&(i[t]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",t,a||e)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(t){var e,r,n,i,s;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){for(i=Object.keys(r),n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},r.prototype.listeners=function(t){return l(this,t,!0)},r.prototype.rawListeners=function(t){return l(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):h.call(t,e)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}})),Rt=Dt(((t,e)=>{var r,n;r=t,n=function(){var t="function"==typeof Promise,e=function(t){if("object"==typeof globalThis)return globalThis;Object.defineProperty(t,"typeDetectGlobalObject",{get:function(){return this},configurable:!0});var e=typeDetectGlobalObject;return delete t.typeDetectGlobalObject,e}(Object.prototype),r=typeof Symbol<"u",n=typeof Map<"u",i=typeof Set<"u",s=typeof WeakMap<"u",o=typeof WeakSet<"u",a=typeof DataView<"u",l=r&&typeof Symbol.iterator<"u",h=r&&typeof Symbol.toStringTag<"u",c=i&&"function"==typeof Set.prototype.entries,u=n&&"function"==typeof Map.prototype.entries,d=c&&Object.getPrototypeOf((new Set).entries()),p=u&&Object.getPrototypeOf((new Map).entries()),f=l&&"function"==typeof Array.prototype[Symbol.iterator],g=f&&Object.getPrototypeOf([][Symbol.iterator]()),m=l&&"function"==typeof String.prototype[Symbol.iterator],w=m&&Object.getPrototypeOf(""[Symbol.iterator]());return function(r){var l,c,u=typeof r;if("object"!==u)return u;if(null===r)return"null";if(r===e)return"global";if(Array.isArray(r)&&(!1===h||!(Symbol.toStringTag in r)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&r===window.location)return"Location";if("object"==typeof window.document&&r===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&r===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&r===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&r instanceof window.HTMLElement){if("BLOCKQUOTE"===r.tagName)return"HTMLQuoteElement";if("TD"===r.tagName)return"HTMLTableDataCellElement";if("TH"===r.tagName)return"HTMLTableHeaderCellElement"}}return"string"==typeof(l=h&&r[Symbol.toStringTag])?l:(c=Object.getPrototypeOf(r))===RegExp.prototype?"RegExp":c===Date.prototype?"Date":t&&c===Promise.prototype?"Promise":i&&c===Set.prototype?"Set":n&&c===Map.prototype?"Map":o&&c===WeakSet.prototype?"WeakSet":s&&c===WeakMap.prototype?"WeakMap":a&&c===DataView.prototype?"DataView":n&&c===p?"Map Iterator":i&&c===d?"Set Iterator":f&&c===g?"Array Iterator":m&&c===w?"String Iterator":null===c?"Object":Object.prototype.toString.call(r).slice(8,-1)}},"object"==typeof t&&typeof e<"u"?e.exports=n():"function"==typeof define&&define.amd?define(n):(r=typeof globalThis<"u"?globalThis:r||self).typeDetect=n()})),Ut=Dt(((t,e)=>{function r(){this._key="chai/deep-eql__"+Math.random()+Date.now()}function n(t,e,r){var n,i;return!r||g(t)||g(e)?null:(n=r.get(t))&&"boolean"==typeof(i=n.get(e))?i:null}function i(t,e,r,n){if(r&&!g(t)&&!g(e)){var i=r.get(t);i?i.set(e,n):((i=new w).set(e,n),r.set(t,i))}}function s(t,e,r){if(r&&r.comparator)return a(t,e,r);var n=o(t,e);return null!==n?n:a(t,e,r)}function o(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e||!g(t)&&!g(e)&&null}function a(t,e,r){var a,g,b,v,x,P,k;if((r=r||{}).memoize=!1!==r.memoize&&(r.memoize||new w),a=r&&r.comparator,null!==(g=n(t,e,r.memoize)))return g;if(null!==(b=n(e,t,r.memoize)))return b;if(a){if(!1===(v=a(t,e))||!0===v)return i(t,e,r.memoize,v),v;if(null!==(x=o(t,e)))return x}return(P=y(t))!==y(e)?(i(t,e,r.memoize,!1),!1):(i(t,e,r.memoize,!0),k=function(t,e,r,n){switch(r){case"String":case"Number":case"Boolean":case"Date":return s(t.valueOf(),e.valueOf());case"Promise":case"Symbol":case"function":case"WeakMap":case"WeakSet":return t===e;case"Error":return f(t,e,["name","message","code"],n);case"Arguments":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"Array":return h(t,e,n);case"RegExp":return function(t,e){return t.toString()===e.toString()}(t,e);case"Generator":return function(t,e,r){return h(u(t),u(e),r)}(t,e,n);case"DataView":return h(new Uint8Array(t.buffer),new Uint8Array(e.buffer),n);case"ArrayBuffer":return h(new Uint8Array(t),new Uint8Array(e),n);case"Set":case"Map":return l(t,e,n);case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.Instant":case"Temporal.ZonedDateTime":case"Temporal.PlainYearMonth":case"Temporal.PlainMonthDay":return t.equals(e);case"Temporal.Duration":return t.total("nanoseconds")===e.total("nanoseconds");case"Temporal.TimeZone":case"Temporal.Calendar":return t.toString()===e.toString();default:return function(t,e,r){var n,i,s=d(t),o=d(e),a=p(t),l=p(e);if(s=s.concat(a),o=o.concat(l),s.length&&s.length===o.length)return!1!==h(m(s).sort(),m(o).sort())&&f(t,e,s,r);n=c(t),i=c(e);return n.length&&n.length===i.length?(n.sort(),i.sort(),h(n,i,r)):0===s.length&&0===n.length&&0===o.length&&0===i.length}(t,e,n)}}(t,e,P,r),i(t,e,r.memoize,k),k)}function l(t,e,r){try{if(t.size!==e.size)return!1;if(0===t.size)return!0}catch{return!1}var n=[],i=[];return t.forEach((function(t,e){n.push([t,e])})),e.forEach((function(t,e){i.push([t,e])})),h(n.sort(),i.sort(),r)}function h(t,e,r){var n,i=t.length;if(i!==e.length)return!1;if(0===i)return!0;for(n=-1;++n<i;)if(!1===s(t[n],e[n],r))return!1;return!0}function c(t){if(function(t){return typeof Symbol<"u"&&"object"==typeof t&&typeof Symbol.iterator<"u"&&"function"==typeof t[Symbol.iterator]}(t))try{return u(t[Symbol.iterator]())}catch{return[]}return[]}function u(t){for(var e=t.next(),r=[e.value];!1===e.done;)e=t.next(),r.push(e.value);return r}function d(t){var e,r=[];for(e in t)r.push(e);return r}function p(t){var e,r,n,i;for(e=[],r=Object.getOwnPropertySymbols(t),n=0;n<r.length;n+=1)i=r[n],Object.getOwnPropertyDescriptor(t,i).enumerable&&e.push(i);return e}function f(t,e,r,n){var i,o=r.length;if(0===o)return!0;for(i=0;i<o;i+=1)if(!1===s(t[r[i]],e[r[i]],n))return!1;return!0}function g(t){return null===t||"object"!=typeof t}function m(t){return t.map((function(t){return"symbol"==typeof t?t.toString():t}))}var w,y=Rt();r.prototype={get:function(t){return t[this._key]},set:function(t,e){Object.isExtensible(t)&&Object.defineProperty(t,this._key,{value:e,configurable:!0})}},w="function"==typeof WeakMap?WeakMap:r,e.exports=s,e.exports.MemoizeMap=w})),$t=Dt((t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.asArraysFactory=void 0,t.asArraysFactory=function(t){return()=>t.map((t=>t.items))}})),zt=Dt((t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.asEntriesFactory=void 0,t.asEntriesFactory=function(t){return e=>{var r,n;let i=null!==(r=e?.keyName)&&void 0!==r?r:"key",s=null!==(n=e?.itemsName)&&void 0!==n?n:"items";return t.map((t=>({[i]:t.key,[s]:t.items})))}}})),Bt=Dt((t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.asMapFactory=void 0,t.asMapFactory=function(t){return()=>{let e=new Map;for(let r of t)e.set(r.key,r.items);return e}}})),Ht=Dt((t=>{function e(t){return"string"==typeof t||"number"==typeof t||"symbol"==typeof t}Object.defineProperty(t,"__esModule",{value:!0}),t.asObjectFactory=void 0,t.asObjectFactory=function(t){return()=>{let r={};for(let n of t)e(n.key)&&(r[n.key]=n.items);return r}}})),qt=Dt((t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.asTuplesFactory=void 0,t.asTuplesFactory=function(t){return()=>t.map((t=>[t.key,t.items]))}})),Yt=Dt((t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.keysFactory=void 0,t.keysFactory=function(t){return()=>t.map((t=>t.key))}})),Gt=Dt((t=>{var e,r,n,i,s,o,a,l=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.group=void 0,e=l(Ut()),r=$t(),n=zt(),i=Bt(),s=Ht(),o=qt(),a=Yt(),t.group=function(t){return Object.freeze({by:l=>{let h=function(t,r){let n=[],i=new Map,s=0;for(let o of t){let t=r(o,s);s++;let a="object"==typeof t?JSON.stringify(t):t,l=i.get(a);null==l&&(l=[],i.set(a,l));let h=!1;for(let r of l)if((0,e.default)(r.key,t)){r.items.push(o),h=!0;break}if(!h){let e={key:t,items:[o]};n.push(e),l.push(e)}}return n}(t,"function"==typeof l?l:t=>t[l]);return Object.freeze({asArrays:(0,r.asArraysFactory)(h),asEntries:(0,n.asEntriesFactory)(h),asMap:(0,i.asMapFactory)(h),asObject:(0,s.asObjectFactory)(h),asTuples:(0,o.asTuplesFactory)(h),keys:(0,a.keysFactory)(h)})}})}})),Qt=Dt((t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.group=void 0;var e=Gt();Object.defineProperty(t,"group",{enumerable:!0,get:function(){return e.group}})})),Kt=class{constructor(t,e){this.offset=t,this.colors=e,this.monochromes=this.colors.map((t=>t.reduce(((t,e)=>t+e))/3)),this.ids=Object.fromEntries(this.colors.map(((t,e)=>[t.toString(),e]))),this.singleColorIds=Object.fromEntries(this.colors.map(((t,e)=>[e,this.colors.findIndex(((r,n)=>e!==n&&t.every(((t,e)=>t===r[e]))))])).filter((([,t])=>-1!==t)))}monochrome(t){return this.monochromes[t]}sameIds(t,e){return t===e||this.singleColorIds[t]===e}same(t,e,r=15){return Math.abs(t[0]-e[0])<r&&Math.abs(t[1]-e[1])<r&&Math.abs(t[2]-e[2])<r}strictSame(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}has(t){return void 0!==this.rgbToId(t)}idToRGB(t){return this.colors[t]}convert(t,e,r){let n=0,i=1/0;for(let s=this.offset;s!==this.colors.length;s++){let o=this.colors[s],a=I(o[0]-t)+I(o[1]-e)+I(o[2]-r);if(0===a)return s;a<i&&(i=a,n=s)}return n}rgbToId(t){return this.ids[t.toString()]||null}},Vt=new Error("no connection"),Xt=new Error("need template source"),Zt=(new Error("no access to canvas api"),new Error("need template position")),Jt=new Error("canvas undefined"),te=new Error("strategy undefined"),ee=new Error("promise deadline"),re=new Error("errAborterTriggered"),ne=new Error("default strategy doesnt exists"),ie=new Error("errSeveralNoPlacePixelResult"),se=new Error("Max attempts reached"),oe=class{constructor(t=6e4){this.triggered=!1,this.resolve=()=>{},this.timeout=setTimeout((()=>this.destroy()),t),this.promise=new Promise((t=>this.resolve=t))}abort(){this.resolve(re),clearTimeout(this.timeout),this.triggered=!0}destroy(){this.resolve(),clearTimeout(this.timeout)}},ae=class t{constructor(t,e,r,n){this.x1=t,this.y1=e,this.x2=r,this.y2=n}get width(){return this.x2-this.x1}set width(t){this.x2=this.x1+t}get height(){return this.y2-this.y1}set height(t){this.y2=this.y1+t}get localCenter(){return[this.width/2,this.height/2]}get center(){return[(this.x1+this.x2)/2,(this.y1+this.y2)/2]}in(t,e){return this.x1<=t&&t<this.x2&&this.y1<=e&&e<this.y2}toArray(){return[this.x1,this.y1,this.x2,this.y2]}moveY(t){this.move(this.x1,t)}moveX(t){this.move(t,this.y1)}move(t,e){let r=this.width,n=this.height;this.x1=t,this.y1=e,this.width=r,this.height=n}copy(){return new t(this.x1,this.y1,this.x2,this.y2)}},le=Ft(Nt()),he=class extends le.default{wait(t,e=5e3){return new Promise(((r,n)=>{let i=setTimeout((()=>n(ee)),e);this.once(t,(t=>{clearTimeout(i),r(t)}))}))}},ce=class extends he{on(t,e){return super.on(t,e)}once(t,e){return super.once(t,e)}wait(t,e){return super.wait(t,e)}off(t,e){return super.off(t,e)}emit(t,e){return void 0!==e?super.emit(t,e):super.emit(t)}},ue=class extends ce{constructor(t,e){super(),this.ws=null,this.url=t,e&&e.reconnectDelay&&this.on(1,(t=>{t.wasClean||setTimeout((()=>this.connect()),e.reconnectDelay)}))}get connected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}get disconnected(){return!this.connected}get connecting(){return this.ws&&this.ws.readyState===WebSocket.CONNECTING}connect(){return new Promise(((t,e)=>{this.ws&&[WebSocket.CONNECTING,WebSocket.OPEN].includes(this.ws.readyState)&&e(new Error("try connect when websocket is OPEN or CONNECTING"));let r=!1;this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{this.emit(0),r=!0,t()},this.ws.onclose=t=>{this.emit(1,t),r||e(t)},this.ws.onerror=t=>{this.emit(2,t)},this.ws.onmessage=({data:t})=>{"string"==typeof t?this.emit(3,t):this.emit(4,t)}}))}async disconnect(){this.ws&&(this.ws.close(),await this.wait(1),this.ws=null)}send(t){if(null===this.ws||this.disconnected)throw Vt;this.ws.send(t)}},de=class{constructor(t,e){this.build=t,this.onerror=e}#t=null;#e=null;get ready(){return null!==this.#t&&!(this.#t instanceof Promise)}async clear(){let t;return this.#t instanceof Promise&&(t=this.#t.then((t=>{if(t&&"destroy"in t)return t.destroy()})).then((()=>{})),this.#t=null,this.#e?.abort(),this.#e=null),null!==this.#t&&(this.#t=null),t||Promise.resolve()}get(){return null===this.#t?(this.#e=new oe,this.#t=Promise.any([this.build().then((t=>this.#t=t)).catch((t=>(this.onerror?.(t),null))),this.#e.promise.then((()=>null))]),this.#t):this.#t instanceof Promise?this.#t:Promise.resolve(this.#t)}getExists(){return Promise.resolve(this.#t)}now(){return null===this.#t||this.#t instanceof Promise?null:this.#t}},pe="https://voidserv.glitch.me",fe=class{constructor(){this.dict=new Map}get(t,e){return this.dict.get(this.coordsToIndex(t,e))}delete(t,e){return this.dict.delete(this.coordsToIndex(t,e))}has(t,e){return this.dict.has(this.coordsToIndex(t,e))}set(t,e,r){this.dict.set(this.coordsToIndex(e,r),t)}clear(){this.dict.clear()}coordsToIndex(t,e){return e+"_"+t}},ge=class{constructor(t){this.data=t}get length(){return this.data.length}get(t){return this.data[t]}set(t,e){this.data[t]=e}},me=class{constructor(){this.updatedAt=0,this.cooldown=0}update(t){this.cooldown=t,this.updatedAt=Date.now()}get(){return Math.max(0,this.cooldown-(Date.now()-this.updatedAt))}},we=class{constructor(){this.timer=new me}get chunkSize(){return this.info.chunkWidth*this.info.chunkHeight}getChunksCoords(t,e,r,n){t=Math.floor((t+this.info.worldWidth/2)/this.info.chunkWidth),e=Math.floor((e+this.info.worldHeight/2)/this.info.chunkHeight),r=Math.floor((r-1+this.info.worldWidth/2)/this.info.chunkWidth),n=Math.floor((n-1+this.info.worldHeight/2)/this.info.chunkHeight);let i=[];for(let s=t;s<=r;s++)for(let t=e;t<=n;t++)i.push([s,t]);return i}toTiled(t,e){return t+=this.info.worldWidth>>1,e+=this.info.worldHeight>>1,[Math.floor(t/this.info.chunkWidth),Math.floor(e/this.info.chunkHeight),e%this.info.chunkHeight*this.info.chunkWidth+t%this.info.chunkWidth]}toWorld(t,e,r){return[t*this.info.chunkWidth-(this.info.worldWidth>>1)+r%this.info.chunkWidth,e*this.info.chunkHeight-(this.info.worldHeight>>1)+Math.floor(r/this.info.chunkWidth)]}},ye=(t,e)=>t[0]===e[0]&&t[1]===e[1],be=(t,e)=>t.some((t=>ye(t,e))),ve=class{constructor(t){this.low=t,this.workspaces=[],this.chunks=[];let{offset:e,colors:r}=this.info.palette;this.palette=new Kt(e,r)}get info(){return this.low.info}on(t,e){return this.low.emitter.on(t,e)}emit(t,e){return this.low.emitter.emit(t,e)}wait(t){return this.low.emitter.wait(t)}getCaptcha(){return this.low.getCaptcha()}sendAnswer(t){return this.low.sendAnswer(t)}getCooldown(){return this.low.timer.get()}pixelsCanPlace(){let t=Math.max(this.info.minCd,this.info.maxCd);return Math.floor((this.info.stack-this.getCooldown())/t)}get(t,e){return this.low.get(t,e)}compare(t){let e=this.get(t.x,t.y);return this.palette.sameIds(e,t.id)}predictCooldown(t,e){return this.low.predictCooldown(t,e)}createWorkspace(t,e,r,n){return{x1:t,y1:e,x2:r,y2:n,chunks:this.low.getChunksCoords(t,e,r,n)}}hasWorkspace(t){return this.workspaces.some((e=>e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2))}async changeWorkspace(t){this.clearWorkspaces(),await this.addWorkspace(t)}async addWorkspace(t){let e=t.chunks.filter((t=>!be(this.chunks,t)));await this.low.prepareChunks(e),this.chunks.push(...e),this.workspaces.push(t)}clearWorkspaces(){this.chunks.length&&this.low.dropChunks(this.chunks),this.chunks=[]}placePixels(t){return this.low.placePixels(t)}async smartPlace(t,e){t=t.slice();let r=new Promise((async r=>{for(;;){if(e?.triggered)return;let n=t.shift();if(!n)break;let i=await this.low.placePixels([n]);if(i)return t.unshift(n),void r([t,i]);t.length&&await this.waitBecausePixelsDistance(n,t[0])}r([t,null])}));if(e){let n=await Promise.any([r,e.promise]);return n instanceof Error?(e.destroy(),[t,n]):n}return r}async download(t,e,r,n){await this.low.prepareChunks(this.low.getChunksCoords(t,e,r,n));let i=r-t,s=n-e,o=document.createElement("canvas").getContext("2d");o.canvas.width=i,o.canvas.height=s;let a=o.getImageData(0,0,i,s),l=a.data;for(let i=e,s=0;i!==n;i++)for(let e=t;e!==r;e++,s+=4){let t=this.palette.idToRGB(this.get(e,i));void 0!==t?(l[0|s]=t[0],l[1|s]=t[1],l[2|s]=t[2],l[3|s]=255):console.log("wrong id",this.get(e,i),"at",e,i)}o.putImageData(a,0,0),Q(o.canvas,`${this.info.name}_${t}_${e}_${r}_${n}`)}destroy(){return this.low.destroy()}waitBecausePixelsDistance(t,e){let r,n=Math.sqrt(I(t.x-e.x)+I(t.y-e.y));return r=1===n?50:n<1.5?100:125*n,_(Math.min(.75*this.info.minCd,r))}},xe={id:-1,name:"",palette:{offset:0,colors:[]},chunkWidth:0,chunkHeight:0,worldWidth:0,worldHeight:0,haveStack:!1,stack:0,minCd:0,maxCd:0,borders:new ae(0,0,0,0)},Pe=Ft(Qt()),ke=0,Te=5,Ee=6,Se=7,Ce=8,Ae=9,Me=10,Oe=11,Ie=12,_e=13,je={errNoPlacePixelResult:new Error("errNoPlacePixelResult"),errMustAuth:new Error("errMustAuth"),errTooLowScore:new Error("errTooLowScore"),errPixelProtected:new Error("errPixelProtected"),errFullStack:new Error("errFullStack"),errCaptcha:new Error("errCaptcha"),errYouAreProxy:new Error("errYouAreProxy"),errCanvasAPIInteraction:new Error("errCanvasAPIInteraction"),errUnknownError:new Error("errUnknownError"),errAPIIsntReady:new Error("errAPIIsntReady"),errResponseIsntOk:new Error('response isnt "ok"'),errResponseStatusIsnt200:new Error("response status isnt 200"),errParallelPlace:new Error("errParallelPlace")},Le={errCaptchaTimeout:new Error("You took too long, try again."),errInvalidSolution:new Error("No or invalid captcha text")},De=((At=De||{})[At.PPF_EARTH=0]="PPF_EARTH",At[At.PPF_MINI=1]="PPF_MINI",At[At.PPF_MOON=2]="PPF_MOON",At[At.PPF_CORONA=3]="PPF_CORONA",At[At.PPF_PZ=4]="PPF_PZ",At[At.PPF_PC=5]="PPF_PC",At[At.PPF_BIT=6]="PPF_BIT",At[At.PPF_TOP=7]="PPF_TOP",At),We={0:"PPF Earth",1:"PPF Minimap",2:"PPF Moon",3:"PPF Corona",4:"PPF PZ mirror",5:"PPF PixelCanvas",6:"PPF Bit",7:"PPF Top10"},Fe=(()=>{if(!unsafeWindow?.ssv?.shard||"fuckyouarkeros.fun"===unsafeWindow.location.host)return"";let t=window.location.host.split(".");return t.length>2&&t.shift(),`${unsafeWindow.ssv.shard}.${t.join(".")}`})(),Ne=Fe&&`${unsafeWindow.location.protocol}//${Fe}`,Re={0:0,1:2,3:3,5:4,6:5,7:6,8:7,11:1},Ue=t=>t[0]<<8|t[1],$e=t=>[t>>8,255&t],ze=class e extends we{constructor(t){super(),this.canvasId=t,this._info=xe,this.loadQueue=[],this.pixelsDelay=150+50*Math.random(),this.delayedPixels=[],this.chunks=new fe,this.threads=5,this.loaders=[],this.chunksProcessing=!1,this.emitter=new ce,this.local=new ce,this.timer=new me,this.ws=new ue(`${"https:"===window.location.protocol?"wss:":"ws:"}//${Fe||window.location.host}/ws`),this.ws.on(0,(async()=>{for(this.emitter.emit(0),this.selectCanvas(this.canvasId),this.emitter.emit(2);this.ws.connected;)await _(19e3),this.ws.send(new Uint8Array([176]).buffer)})),this.ws.on(4,(t=>{let e=new DataView(t);switch(e.getUint8(0)){case 145:this.handleArrivedPixel(function(t){let e=t.getUint8(1),r=t.getUint8(2),n=[],i=t.byteLength;for(;i>3;){let e=t.getUint8(i-=1),r=t.getUint16(i-=2),s=t.getUint8(i-=1)<<16;n.push([s|r,e])}return{i:e,j:r,pixels:n}}(e));break;case 195:let{retCode:t,wait:r}=function(t){return{retCode:t.getUint8(1),wait:t.getUint32(2),coolDownSeconds:t.getInt16(6),pxlCnt:t.getUint8(8),rankedPxlCnt:t.getUint8(9)}}(e);this.timer.update(r),this.local.emit(0,t);break;case 198:this.local.emit(1,function(t){return t.getUint8(1)}(e));break;case 194:this.timer.update(function(t){return t.getUint32(1)}(e))}})),this.ws.on(1,(()=>this.emitter.emit(1)))}get info(){if(this._info===xe)throw je.errAPIIsntReady;return this._info}static async build(t){let r=new e(t);return await r.fetchMe(),await r.ws.connect(),r}get(t,e){for(let r of this.delayedPixels){let n=r.find((r=>r.x===t&&r.y===e));if(n)return n.id}return this.getHumanlike(t,e)}getHumanlike(t,e){let r=this.toTiled(t,e);return this.chunks.get(r[0],r[1]).get(r[2])}dropChunks(t){let e=[];for(let r of t){let t=Ue(r);if(this.chunks.has(r[0],r[1])){e.push(r),this.chunks.delete(r[0],r[1]);continue}if(this.loadQueue.includes(t)){this.loadQueue=this.loadQueue.filter((e=>e!==t));continue}let n=this.loaders.filter((e=>e.chunk===t));n.length&&(n.forEach((t=>t.aborter.abort())),this.loaders=this.loaders.filter((e=>e.chunk!==t)))}e.length&&this.deRegisterChunks(e)}async prepareChunks(t){this.ws.disconnected&&await this.emitter.wait(2),t.forEach((t=>this.loadQueue.push(Ue(t)))),this.processMarked(),await this.waitChunks(t)}async placePixels(e){let r=this.groupPixels(e),n=null;for(let e in r){let i=r[e],s=$e(+e);if(this.emitter.emit(4,i.map((({offset:t,id:e})=>{let[r,n]=this.toWorld(s[0],s[1],t);return{x:r,y:n,id:e}}))),this.ws.send(t(s[0],s[1],i.map((t=>[t.offset,t.id])))),n=await this.local.wait(0,500).then((t=>{switch(t){case ke:let e=this.chunks.get(s[0],s[1]);return e&&i.forEach((t=>e.set(t.offset,t.id))),null;case Te:return je.errCanvasAPIInteraction;case Ee:return je.errMustAuth;case Se:return je.errTooLowScore;case Ce:return je.errPixelProtected;case Ae:return je.errFullStack;case Me:return je.errCaptcha;case Oe:return je.errYouAreProxy;case Ie:return je.errTooLowScore;case _e:return je.errParallelPlace;default:return new Error(`unknown retcode: ${t}`)}})).catch((t=>t===ee?je.errNoPlacePixelResult:t)),n)return n}return n}async getCaptcha(){let t=await fetch(Ne+"/captcha.svg",{cache:"no-cache"});if(!t.ok||200!==t.status)throw je.errCanvasAPIInteraction;let e=URL.createObjectURL(await t.blob()),r=t.headers.get("captcha-id");if(null===r)throw je.errCanvasAPIInteraction;return{id:r,svg:await fetch(e).then((t=>t.text()))}}async sendAnswer({solution:t,id:e}){this.ws.send(`cs,${JSON.stringify([t,e])}`);let r=await this.local.wait(1),n=[!0,Le.errCaptchaTimeout,!1,Le.errInvalidSolution,je.errCanvasAPIInteraction];return n.length>r?n[r]:je.errUnknownError}predictCooldown(t,e){let r=this.toTiled(t,e);return this.chunks.get(r[0],r[1]).get(r[2])<this.info.palette.offset?this.info.minCd:this.info.maxCd}destroy(){return this.dropChunks(this.loadQueue.map($e)),this.ws.disconnect()}groupPixels(t){let e=(0,Pe.group)(t).by((t=>Ue(this.toTiled(t.x,t.y).slice(0,2)))).asArrays(),r={};return e.forEach((t=>{let e=this.toTiled(t[0].x,t[0].y),n=Ue(e.slice(0,2));r[n]=t.map((t=>({offset:this.toTiled(t.x,t.y)[2],id:t.id})))})),r}async waitChunks(t){for(t=t.slice().filter((t=>!this.chunks.has(t[0],t[1])));t.length;){let e=await this.emitter.wait(5),r=Ue(e),n=t.findIndex((t=>Ue(t)===r));-1!==n&&t.splice(n,1)}}processMarked(){if(!this.chunksProcessing){for(this.chunksProcessing=!0;this.loaders.length<this.threads;){let t=this.loadQueue.pop();if(void 0===t)break;let e=$e(t);if(this.chunks.has(e[0],e[1])||this.loaders.some((e=>e.chunk===t)))continue;let r={chunk:t,aborter:new AbortController};this.loaders.push(r),this.fetchChunk(e,r.aborter).then((t=>{this.chunks.set(t,e[0],e[1]),this.registerChunk(e),this.loaders.splice(this.loaders.indexOf(r),1),this.processMarked()}))}this.chunksProcessing=!1}}fetchChunk(t,e){let r=e?{signal:e.signal}:{};return fetch(`${Ne}/chunks/${this.canvasId}/${t[0]}/${t[1]}.bmp`,r).then((t=>{if(!t.ok)throw console.debug(t),je.errResponseIsntOk;if(200!==t.status)throw console.debug(t),je.errResponseStatusIsnt200;return t.arrayBuffer()})).then((e=>{let r=new Uint8Array(e),n=new Uint32Array(this.chunkSize);if(r.length===this.chunkSize)for(let t=0;t!==r.length;t++){let e=r[t];n[t]=e>=128?e-128:e}return this.emitter.emit(5,t),new ge(n)}))}registerChunk(t){this.ws.send(function(t){let e=new ArrayBuffer(3),r=new DataView(e);return r.setInt8(0,161),r.setInt16(1,t),e}(Ue(t)))}deRegisterChunks(t){this.ws.send(function(t){let e=new ArrayBuffer(2+2*t.length),r=new Uint16Array(e);r[0]=164;for(let e=0;e<t.length;e+=1)r[e+1]=t[e];return e}(t.map((t=>Ue(t)))))}toTiled(t,e){let r=t+(this.info.worldWidth>>1),n=e+(this.info.worldHeight>>1);return[r>>8,n>>8,(255&n)<<8|255&r]}toWorld(t,e,r){return[(t<<8)-(this.info.worldWidth>>1)+(255&r),(e<<8)-(this.info.worldHeight>>1)+(r>>8)]}selectCanvas(t){this.ws.send(function(t){let e=new ArrayBuffer(2),r=new DataView(e);return r.setInt8(0,160),r.setInt8(1,Number(t)),e}(t))}async fetchMe(){let t=(await fetch(`${Ne}/api/me`).then((t=>t.json()))).canvases[this.canvasId],{size:e}=t,r=Re[this.canvasId];this._info={id:r,name:We[r],palette:{offset:t.cli,colors:t.colors},chunkWidth:256,chunkHeight:256,worldWidth:e,worldHeight:e,haveStack:!0,stack:t.cds,minCd:t.bcd,maxCd:t.pcd,borders:new ae(-e/2,-e/2,e/2,e/2)}}handleArrivedPixel(t){let e=t.pixels.map((e=>{let[r,n]=this.toWorld(t.i,t.j,e[0]);return{x:r,y:n,id:e[1]}}));this.emitter.emit(3,e),this.delayedPixels.push(e),setTimeout((()=>{let r=this.delayedPixels.indexOf(e);if(-1!==r){this.delayedPixels.splice(r,1);let e=this.chunks.get(t.i,t.j);e&&t.pixels.forEach((t=>e.set(t[0],t[1])))}}),this.pixelsDelay)}},Be={};Be[0]=()=>ze.build(0),Be[2]=()=>ze.build(1),Be[3]=()=>ze.build(3),Be[4]=()=>ze.build(5),Be[5]=()=>ze.build(6),Be[6]=()=>ze.build(7),Be[7]=()=>ze.build(8),Be[1]=()=>ze.build(11),c=Be,u={},Object.entries(c).forEach((([t,e])=>{u[t]=()=>e().then((t=>new ve(t)))})),Object.keys(u),d=t=>u[t](),f={random:t=>W(p(t)),line_upToDown:p=t=>{let e=[],r=t.width,n=t.height;for(let i=0;i!==n;i++)for(let n=0;n!==r;n++)t.isTransparent(n,i)||e.push([n,i]);return e},line_downToUp:t=>{let e=p(t);for(let t=0;t!==e.length>>1;t++){let r=e.length-t-1;F(e,t,r)}return e},line_leftToRight:t=>U(p(t),(t=>t[0])),line_RightToLeft:t=>R(p(t),(t=>t[0])),circle_inToOut:t=>{let[e,r]=t.localCenter;return R(p(t),(t=>N(t[0]-e)+N(t[1]-r)))},circle_outToIn:t=>{let[e,r]=t.localCenter;return U(p(t),(t=>N(t[0]-e)+N(t[1]-r)))},throughLine:t=>{let e=t.size;return U(p(t),(t=>1&t[1]?t[0]+t[1]:t[0]+t[1]-e))},chess_1x1:t=>{let e=t.size;return U(p(t),(t=>(1&t[0])!=(1&t[1])?t[1]+e:t[1]))},chess_2x2:t=>{let e=t.size;return U(p(t),(t=>(3&t[0]^3&t[1])<=1?t[1]-e:t[1]))},chess_3x3:t=>{let e=t.size;return U(p(t),(t=>(7&t[0]^7&t[1])<=3?t[1]-e:t[1]))},chessCorner_1x1:t=>{let e=t.size;return U(p(t),(t=>(1&t[0])!=(1&t[1])?t[0]+t[1]+e:t[0]+t[1]))},woyken:t=>{let e=t.size,[r,n]=t.localCenter;return R(p(t),(i=>{let s=i[0],o=i[1];if(0!==s&&0!==o&&s!==t.width-1&&o!==t.height-1&&t.isOutline(s,o))return-e+o;if((s+o)%8==0||Math.abs(s-o)%8==0)return o;let a=N(s-r)+N(o-n);return e-Math.trunc(Math.sqrt(a))}))},colorByColor:t=>{let e=p(t),r={};e.forEach((e=>{let n=t.get(e[0],e[1]),i=r[n];i?i.push(e):r[n]=[e]})),e=new Array(e.length);let n=t.size,i=[t.width/2,t.height/2],s=0;return Object.values(r).forEach((t=>{U(t,(t=>n-Math.trunc(Math.sqrt(N(t[0]-i[0])+N(t[1]-i[1]))))),t.forEach((t=>e[s++]=t))})),e},squareBySquare:t=>{let e=[];for(let r=0;r<t.height;r+=8)for(let n=0;n<t.width;n+=8)for(let i=r;i!==r+8&&!(i>=t.height);i++)for(let r=n;r!==n+8;r++)r>=t.width||t.isTransparent(r,i)||e.push([r,i]);return e},zipper:t=>U(p(t),(t=>Math.trunc(Math.sqrt(t[0]+t[1])))),zipper2:t=>U(p(t),(e=>Math.trunc(Math.sqrt(e[0]+e[1]-3*t.get(e[0],e[1]))))),rhombLine:t=>{let[e,r]=t.localCenter;return p(t).sort(((t,n)=>Math.sin(Math.abs(t[0]-e)+Math.abs(t[1]-r))-Math.sin(Math.abs(n[0]-e)+Math.abs(n[1]-r))))},rhombLine2:t=>{let[e,r]=t.localCenter;return p(t).sort(((t,n)=>Math.tan(Math.abs(t[0]-e)+Math.abs(t[1]-r))-Math.tan(Math.abs(n[0]-e)+Math.abs(n[1]-r))))},alienRandom:t=>p(t).sort(((t,e)=>Math.tan(I(t[0]-e[1])-I(t[1]-e[0])))),alien1:t=>U(p(t),(t=>Math.tan(I(t[0])+I(t[1])))),alien2:t=>U(p(t),(t=>Math.exp(Math.cos(t[0]*t[1])))),alien3:t=>{let e=new Map;return U(p(t),(t=>{let r=e.get(t[0]);return void 0===r&&(r=Math.pow(7,t[0]*Math.sin(t[0])),e.set(t[0],r)),r-Math.pow(t[0],7*Math.sin(t[1]))}))},alien4:t=>{let e=new Map,r=new Map;return U(p(t),(t=>{let n=e.get(t[0]);void 0===n&&(n=Math.pow(Math.sin(t[0]),t[0]),e.set(t[0],n));let i=r.get(t[1]);return void 0===i&&(i=Math.pow(Math.cos(t[1]),t[1]),r.set(t[1],i)),n+i}))},complex:t=>{let[i,s]=function(t,e){let r=t.width-1,n=t.height-1,i=[],s=[];return e.forEach((e=>{0===e[0]||0===e[1]||e[0]===r||e[1]===n||t.isOutline(e[0],e[1])?i.push(e):s.push(e)})),[i,s]}(t,p(t)),o=(t,e)=>I(t[0]-e[0])+I(t[1]-e[1]),a=Object.values(e(t,s)),l=R(Object.values(e(t,i)),(t=>t.length));i=s=[];let h=a.map(r),c=[],u=[];for(let e=0;e!==l.length;e++){let i=l[e],s=r(i),d=t.get(i[0][0],i[0][1]);u.push(n(W(i)));let p=-1,f=1/0;if(a.forEach(((e,r)=>{let n=t.get(e[0][0],e[0][1]);if(d!==n||c.includes(r))return;let i=o(s,h[r]);i<f&&(f=i,p=r)})),-1===p){if(c.length===a.length){u.push(...l.slice(e+1).map(n));break}for(;-1===p;)p=Math.trunc(Math.random()*a.length),c.includes(p)&&(p=-1)}else c.push(p),u.push(n(a[p]))}return[].concat(...u)},binary:t=>U(p(t),(t=>t[0]&t[1])),near:t=>n(W(p(t)))},g=new Error("template unloaded"),m=new Error("template unquantized"),w=class t extends ae{constructor(e){super(e.x,e.y,e.x+(e.width||0),e.y+(e.height||0)),this.readyState=t.UNLOADED,this.ctx=null,this.ids=new Uint8Array(0),this.name=e.name}static{this.UNLOADED=0}static{this.LOADING=1}static{this.LOADED=2}static{this.QUANTIZED=3}get canvas(){return this.ctx?.canvas}get size(){return this.width*this.height}get(t,e){return this.ids[t+e*this.width]}isTransparent(t,e){return 255===this.get(t,e)}countTransparent(){if(this.readyState===t.QUANTIZED){let t=0;for(let e of this.ids)255===e&&t++;return t}throw m}isOutline(t,e){let r=this.get(t,e);return this.get(t-1,e-1)!==r||this.get(t-1,e)!==r||this.get(t-1,e+1)!==r||this.get(t,e-1)!==r||this.get(t,e+1)!==r||this.get(t+1,e-1)!==r||this.get(t+1,e)!==r||this.get(t+1,e+1)!==r}intersects(t,e,r,n){return this.x1<r&&this.x2>t&&this.y1<n&&this.y2>e}load(e){return this.readyState=t.LOADING,S(e).then((e=>(this.ctx=document.createElement("canvas").getContext("2d"),this.ctx.canvas.width=this.width=e.width,this.ctx.canvas.height=this.height=e.height,this.ctx.drawImage(e,0,0),this.readyState=t.LOADED,this)))}quantize(e){if(!this.ctx)throw g;let r=this.ctx.getImageData(0,0,this.width,this.height),n=r.data;this.ids=new Uint8Array(n.length>>2);let i=new Map;for(let t=0;t!==n.length;t+=4)if(0===n[3|t])this.ids[t>>2]=255,n[0|t]=n[1|t]=n[2|t]=n[3|t]=0;else{let r=n[0|t]<<16|n[1|t]<<8|n[2|t],s=i.get(r);s||(s=e.convert(r>>16,r>>8&255,255&r),i.set(r,s)),this.ids[t>>2]=s;let o=e.idToRGB(s);n[0|t]=o[0],n[1|t]=o[1],n[2|t]=o[2],n[3|t]=255}return this.ctx.putImageData(r,0,0),this.readyState=t.QUANTIZED,this}},y=class{constructor(t,e){this.api=t,this.template=e,this.template.readyState===w.LOADED&&this.template.quantize(this.api.palette)}get width(){return this.template.width}get height(){return this.template.height}_countErrors(){let t=this.api.palette,e=0,r=0,n=this.template.width,i=this.template.height;for(let s=0;s!=i;s++)for(let i=0;i!=n;i++){let n=this.template.get(i,s);if(255===n)continue;let o=i+this.template.x1,a=s+this.template.y1,l=this.api.get(o,a);t.sameIds(n,l)||(e++,r+=this.api.predictCooldown(o,a))}return{errors:e,timeToEnd:r}}checkTarget(t){return!this.api.palette.sameIds(this.template.get(t[0],t[1]),this.api.get(t[0]+this.template.x1,t[1]+this.template.y1))}handleTarget(t){let e=this.template.get(t[0],t[1]),r=this.api.get(t[0]+this.template.x1,t[1]+this.template.y1);if(!this.api.palette.sameIds(e,r))return{x:t[0]+this.template.x1,y:t[1]+this.template.y1,id:e}}targetToPixel(t){return{x:t[0]+this.template.x1,y:t[1]+this.template.y1,id:this.template.get(t[0],t[1])}}pixelToTarget(t){return[t.x-this.template.x1,t.y-this.template.y1]}},b=class{constructor(t){this.max=t,this.value=0}get(){return this.value}inc(t=1){for(let e=0;e!==t;e++)this.value++,this.value===this.max&&(this.value=0);return this.value}deinc(){return this.value--,-1===this.value&&(this.value=this.max-1),this.value}},v=class extends y{constructor(t,e,r){super(t,e),this.targets=r(this.template),this.counter=new b(this.targets.length)}nexts(t){let e=this.targets.length,r=[],n=this.handleTarget(this.targets[this.counter.get()]);if(n&&r.push(n)===t)return r;for(let n=0;n!==e&&0!==this.counter.get();n++){let e=this.handleTarget(this.targets[this.counter.deinc()]);if(!e)break;if(r.push(e)===t)return r}for(let n=0;n!==e;n++){let e=this.handleTarget(this.targets[this.counter.inc()]);if(e&&r.push(e)===t)return r}return r}countErrors(){return this.targets?this.countErrorsUsingTargets():this._countErrors()}countTargets(){return this.targets.length}countErrorsUsingTargets(){let t=this.api.palette,e=0,r=0;for(let n=0;n!==this.targets.length;n++){let i=this.targets[n],s=i[0]+this.template.x1,o=i[1]+this.template.y1;!t.sameIds(this.template.get(i[0],i[1]),this.api.get(s,o))&&(e++,r+=this.api.predictCooldown(s,o))}return{errors:e,timeToEnd:r}}},x={};for(let t in f)x[t]=(e,r)=>new v(e,r,f[t]);if(P=(t,e,r)=>"string"==typeof r?r in x?x[r](t,e):void 0:new v(t,e,r),k=(t,e)=>{"Notification"in window&&("granted"===Notification.permission?new Notification(t,e):"denied"!==Notification.permission&&Notification.requestPermission((r=>"granted"===r&&new Notification(t,e))))},T=(t,e,r=[])=>{let n=document.createElement(t);if(!e)return n;if(e.id&&n.setAttribute("id",e.id),e.class&&n.setAttribute("class",e.class),e.style&&n.setAttribute("style",e.style),e.html?n.innerHTML=e.html:e.text&&(e.breakText?n.innerText=O(e.text):n.innerText=e.text),e.listeners&&Object.entries(e.listeners).forEach((([t,e])=>{t.startsWith("on")?n.addEventListener(t.substring(2),e):n.addEventListener(t,e)})),e.attributes&&Object.entries(e.attributes).forEach((([t,e])=>n.setAttribute(t,e))),e.shadow&&n.attachShadow({mode:"open"}),0!==r.length){let t=n.shadowRoot||n;r.forEach((e=>t.appendChild(e)))}return n},E=t=>document.querySelector(t),S=t=>new Promise(((e,r)=>{let n=new Image;n.crossOrigin="",n.onload=()=>e(n),n.onerror=r,n.src=t})),C=new Set,A=()=>{let t=0;do{t=parseInt(Math.random().toString().substring(2))}while(C.has(t));return C.add(t),t},M=()=>A().toString().split("").map((t=>String.fromCharCode(65+parseInt(t)%26))).join(""),O=t=>t.split("").join("â€Ž"),I=t=>t*t,_=t=>new Promise((e=>setTimeout(e,t))),j=t=>Date.now()-t,L=new RegExp(/-?\d+/g),D=t=>t.match(L)?.map(parseFloat),W=t=>{for(let e=t.length-1;-1!==e;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t},F=(t,e,r)=>{let n=t[e];t[e]=t[r],t[r]=n},N=t=>I(Math.floor(t)),R=(t,e)=>t.sort(((t,r)=>e(t)>e(r)?1:-1)),U=(t,e)=>t.sort(((t,r)=>e(t)<e(r)?1:-1)),$=t=>{let e=0;for(let r=0;r!==t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e},z=()=>{if(/.*:\/\/.*(pixelplanet)|(fuckyouarkeros)\.fun.*/.test(location.origin)||/localhost/.test(location.origin)){let t=location.hash.match(/#[a-z]/g);return t?.length?{d:0,s:1,m:2,c:3,y:4,z:5,w:6,t:7}[t[0][1]]:void 0}},B=(t,e)=>t+Math.floor(Math.random()*(e-t)),H=t=>t[t.length-1],q=(t,e,r)=>{let n=0,i=0,s=0,o=0,a=t=>G(0,t,unsafeWindow.innerWidth-e.offsetWidth),l=t=>G(0,t,unsafeWindow.innerHeight-e.offsetHeight);e.style.top=l(e.offsetTop)+"px",e.style.left=a(e.offsetLeft)+"px";let h=t=>{t.preventDefault(),n=s-t.clientX,i=o-t.clientY,s=t.clientX,o=t.clientY,e.style.top=l(e.offsetTop-i)+"px",e.style.left=a(e.offsetLeft-n)+"px"},c=()=>{window.removeEventListener("mouseup",c),window.removeEventListener("mousemove",h);let t=D(e.style.left),n=D(e.style.top);t&&n&&r&&r(t[0],n[0])};t.addEventListener("mousedown",(t=>{t.preventDefault(),s=t.clientX,o=t.clientY,window.addEventListener("mouseup",c),window.addEventListener("mousemove",h)}))},Y=null,document.addEventListener("keydown",(t=>{Y&&(t.stopPropagation(),Y(t))}),!0),Y=null,G=(t,e,r)=>Math.max(t,Math.min(e,r)),(()=>{let t=new DataView(new ArrayBuffer(4));return e=>(t.setInt16(0,e[0]),t.setInt16(2,e[1]),t.getInt32(0))})(),(()=>{let t=new DataView(new ArrayBuffer(4));return e=>(t.setInt32(0,e),[t.getInt16(0),t.getInt16(2)])})(),Q=(t,e="unnamed")=>{let r=document.createElement("a");r.setAttribute("href",t.toDataURL("image/png")),r.setAttribute("download",e),r.click()},K=(t,e="unnamed")=>{let r=document.createElement("a");r.setAttribute("href","data:text/html;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.click()},V=t=>{if(!(t instanceof v))return;let{width:e,height:r,targets:n}=t,i=document.createElement("canvas").getContext("2d");i.canvas.width=e,i.canvas.height=r;let s=i.getImageData(0,0,e,r),{data:o}=s;return n.forEach(((t,r)=>{let i=Math.floor((n.length-r)/n.length*255),s=t[1]*e+t[0]<<2;o[0|s]=i,o[3|s]=255})),i.putImageData(s,0,0),i},X=t=>{if(!(t instanceof v))return;let{width:e,height:r,targets:n}=t,i=new Array(n.length<<1),s=new Array(n.length);n.forEach(((e,r)=>{i[r<<1]=e[0].toString(),i[r<<1|1]=e[1].toString(),s[r]=t.template.get(e[0],e[1]).toString()}));let o=t.api.palette.colors.flat();return`\n\t\t<!DOCTYPE html>\n\t\t<html>\n\t\t\t<body style="background: black;">\n\t\t\t\t<div style="position: absolute; top: 0; left: 0; height: 100%">\n\t\t\t\t\t<canvas style="height: 100%; border: 1px red solid; background: rgba(64, 64, 64, 0.3);"></canvas>\n\t\t\t\t</div>\n\t\t\t\t<script>\n\t\t\t\t\tconst width = ${e};\n\t\t\t\t\tconst height = ${r};\n\t\t\t\t\tconst ctx = document.querySelector('canvas').getContext('2d');\n\t\t\t\t\tctx.canvas.width = width;\n\t\t\t\t\tctx.canvas.height = height;\n\t\t\t\t\tctx.clearRect(0, 0, width, height);\n\n\t\t\t\t\tctx.mozImageSmoothingEnabled = false;\n\t\t\t\t\tctx.webkitImageSmoothingEnabled = false;\n\t\t\t\t\tctx.msImageSmoothingEnabled = false;\n\t\t\t\t\tctx.imageSmoothingEnabled = false;\n\n\t\t\t\t\tconst delay = 100;\n\t\t\t\t\tconst pixelsAtOnce = 10;\n\n\t\t\t\t\tconst targets = new Uint16Array([${i.join(",")}]);\n\t\t\t\t\tconst colors = new Uint8Array([${s.join(",")}]);\n\t\t\t\t\tconst palette = new Uint8Array([${o.join(",")}]);\n\n\t\t\t\t\t(async () => {\n\t\t\t\t\t\tlet prevClrId = -1;\n\t\t\t\t\t\tfor (let i = 0; i !== targets.length; i+=2) {\n\t\t\t\t\t\t\tconst id = colors[i >> 1];\n\t\t\t\t\t\t\tif (prevClrId !== id) {\n\t\t\t\t\t\t\t\tconst j = id * 3;\n\t\t\t\t\t\t\t\tctx.fillStyle = 'rgb(' + [palette[j], palette[j + 1], palette[j + 2]] + ')';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tctx.fillRect(targets[i], targets[i | 1], 1, 1)\n\t\t\t\t\t\t\tconst a = (i >> 1) / pixelsAtOnce;\n\t\t\t\t\t\t\tif (~~a === a) {\n\t\t\t\t\t\t\t\tawait new Promise(r => setTimeout(r, delay));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t<\/script>\n\t\t\t</body>\n\t\t</html>`},Z=async({delay:t,func:e,maxAttempts:r,onerror:n})=>{let i=0;for(;i<r;)try{return await e()}catch(e){i++,n?.(e),await _(t)}throw se},J=class extends he{constructor(t){super(),this.localStorageData={},this.data={},this.localStorageKey="storage",t&&t.localStorageKey&&(this.localStorageKey=t.localStorageKey),this.load()}set(t,e,r=!0){if(r&&t in this.data||!r&&t in this.localStorageData)throw new Error(`try to duplicate field "${t}" with value "${e}"`);r?(this.emit("beforeChangeLC."+t,e),this.localStorageData[t]=e,this.save(),this.emit("afterChangeLC."+t,e)):(this.emit("beforeChange."+t,e),this.data[t]=e,this.emit("afterChange."+t,e))}get(t){return t in this.data?this.data[t]:t in this.localStorageData?this.localStorageData[t]:null}has(t){return t in this.data||t in this.localStorageData}save(){Object.keys(this.localStorageData).length&&localStorage.setItem(this.localStorageKey,JSON.stringify(this.localStorageData))}load(){let t=localStorage.getItem(this.localStorageKey);null!==t&&(this.localStorageData=JSON.parse(t))}},tt=4e3,et=class extends ce{constructor(t="https://voidserv.glitch.me"){super(),this.online=null,this.url=t,(async()=>{for(;;)await this.ping().then((t=>{this.online=t,this.emit(0,this.online)})).catch((t=>{this.online=null,this.emit(1,t)})),await _(this.getPingDelay())})()}getOnline(){return this.online}getPingDelay(){return null===this.online?12e4:36e5/tt*this.online+4e4}ping(){return fetch(this.url+"/online",{method:"POST"}).then((t=>t.text())).then((t=>+t))}},rt={"void-bot":M(),half:M(),"color-box":M()},nt={coords:".coorbox",gameCanvas:".viewport"},it='#void-bot {\r\n\tbackground-color: black;\r\n\tcolor: red;\r\n\tpadding: 3px;\r\n\tposition: absolute;\r\n\ttop: 2%;\r\n\tright: 2%;\r\n\twidth: 40%;\r\n\tfont-weight: bold;\r\n}\r\n\r\n#void-bot input[type="checkbox"] button select {\r\n\tcursor: pointer;\r\n}\r\n\r\n#void-bot input[type="number"] {\r\n\tbackground-color: black;\r\n\tcolor: red;\r\n\tborder-color: darkred;\r\n\twidth: 60px;\r\n}\r\n\r\n#void-bot select {\r\n\tbackground-color: black;\r\n\tcolor: red;\r\n\tborder-color: darkred;\r\n\tfont: inherit;\r\n}\r\n\r\n#void-bot button {\r\n\tbackground-color: black;\r\n\tcolor: red;\r\n\tborder-color: darkred;\r\n\tfont: inherit;\r\n\tmargin: 5px;\r\n}\r\n\r\n#void-bot .half {\r\n\twidth: calc(50% - 5px);\r\n\tmargin-left:5px;\r\n}\r\n\r\n#void-bot .color-box {\r\n\tdisplay: inline-block;\r\n\twidth: 12px;\r\n\theight: 12px;\r\n\tborder: solid 1px darkred;\r\n}',Object.entries(rt).forEach((([t,e])=>{it=it.replace(new RegExp(t,"g"),e)})),st=it,ot=new ce,at={},lt="zipper2",ht={smartPlace:!0,showErrors:!0},ct=!0,ut=[16,16],dt=new Map,pt=$(lt).toString(),dt.set(pt,lt),ft=class{constructor(){this.addStrategy=t=>{let e=$(t).toString();dt.set(e,t),this.strategyElement.appendChild(T("option",{breakText:!0,text:t,attributes:{value:e}}))},this.root=T("div",{id:rt["void-bot"],style:`\n\t\t\t\ttop: ${at.storage.get("window.y")??ut[1]}px;`},[this.title=T("div",{style:"font-size: 110%; cursor: move;",breakText:!0,text:"Make Void great again!"}),T("hr",{style:"border-color: darkred; margin: 3px 0px 3px 0px;"}),this.left=T("div",{class:rt.half,style:"float: left;"}),this.right=T("div",{class:rt.half,style:"float: right;"})]),this.right.appendChild(T("div",{breakText:!0,text:"online: "},[this.botOnline=T("span",{text:"null"})])),this.right.appendChild(T("div",{breakText:!0,text:"status: "},[this.botStatusElement=T("span")])),this.right.appendChild(T("div",{breakText:!0,text:"cooldown: "},[this.timerElement=T("span")])),this.right.appendChild(T("div",{breakText:!0,text:"errors: "},[this.errorsAmount=T("span",{text:"?"})])),this.right.appendChild(T("div",{breakText:!0,text:"progress: "},[this.progress=T("span",{text:"?"})])),this.right.appendChild(T("div",{breakText:!0,text:"end in: "},[this.buildPredict=T("span",{text:"?"})])),this.right.appendChild(T("div",{breakText:!0,text:"placed: "},[this.placedPixel=T("span",{breakText:!0,text:"x y"}),this.placedPixelColor=T("span",{class:rt["color-box"]})])),this.left.appendChild(T("div",{},[T("span",{text:"x: "},[this.xInput=T("input",{listeners:{input:()=>ot.emit(3,+this.xInput.value)},attributes:{type:"number",value:at.storage.get("template.x")?.toString()||""}})]),T("span",{text:"y: "},[this.yInput=T("input",{listeners:{input:()=>ot.emit(4,+this.yInput.value)},attributes:{type:"number",value:at.storage.get("template.y")?.toString()||""}})])])),this.left.appendChild(T("div",{breakText:!0,text:"strategy: "},[this.strategyElement=T("select",{listeners:{change:()=>{let t=dt.get(this.strategyElement.value);t?ot.emit(6,t):(console.warn(`cant define strategy for hash "${this.strategyElement.value}"\nuse default ("${lt}")`),ot.emit(6,lt))}}})])),this.left.appendChild(T("div",{},[this.captchaStop=T("input",{attributes:{type:"checkbox"},listeners:{click:()=>ot.emit(12,this.captchaStop.checked)}}),T("span",{breakText:!0,text:"stop on captcha"})])),this.captchaStop.checked=at.storage.get("stopOnCaptcha")??ct,this.left.appendChild(T("input",{style:"background-color: black; border-color: darkRed; color: red;",attributes:{type:"file",style:"width:100%;"},listeners:{change:t=>{let e=new FileReader,{files:r}=t.composedPath()[0];r&&r.length&&(e.readAsDataURL(r[0]),e.onerror=console.error,e.onload=()=>ot.emit(2,e.result))}}})),this.left.appendChild(T("button",{text:"heatmap",breakText:!0,listeners:{click:()=>ot.emit(14)}})),this.left.appendChild(T("button",{text:"heatweb",breakText:!0,listeners:{click:()=>ot.emit(15)}})),this.left.appendChild(T("button",{breakText:!0,text:"on/off",listeners:{click:()=>ot.emit(5)}})),document.body.appendChild(this.root),document.head.appendChild(T("style",{html:st}));let t=at.storage.get("window.x");this.root.style.left=t?t.toString()+"px":(unsafeWindow.innerWidth-this.root.offsetWidth-ut[0]).toString()+"px",q(this.title,this.root,((t,e)=>{at.storage.set("window.x",t),at.storage.set("window.y",e)}))}setBotOnline(t){this.botOnline.innerText=null===t?"?":t.toString()}setBotStatus(t){this.botStatusElement.innerText=O("string"==typeof t?t:t.message)}setCooldown(t){this.timerElement.innerText=null===t?"?":t.toFixed(2).toString()}setBuildPredict(t,e){if(null===t)this.buildPredict.innerText="?";else{let r=[t];void 0!==e&&t!==e&&r.push(e),r[0]>7200?this.buildPredict.innerText=r.map((t=>t/3600)).map((t=>t.toFixed(1))).join("-")+"h":r[0]>120?this.buildPredict.innerText=r.map((t=>t/60)).map((t=>t.toFixed(1))).join("-")+"m":this.buildPredict.innerText=r.map((t=>t.toFixed(1))).join("-")+"s"}}setProgress(t,e){if(null===t)void 0===e?(this.errorsAmount.innerText="?",this.progress.innerText="?"):(this.errorsAmount.innerText="?",this.progress.innerText=`?/${this.formatIntNumbers(e)[0]}`);else if(void 0===e)this.errorsAmount.innerText=this.formatIntNumbers(t)[0],this.progress.innerText="?";else{let r=e-t,n=(r/e*100).toFixed(2);this.errorsAmount.innerText=this.formatIntNumbers(t)[0],this.progress.innerText=this.formatIntNumbers(r,e).join("/")+` (${n}%)`}}formatIntNumbers(...t){let e=t.some((t=>t>1e3))?1e3:0;return t.map((t=>(t=Math.floor(t),0===e?t.toString():(t/e).toFixed(1)+"k")))}setLastPlaced(t,e,r){this.placedPixel.innerText=`${t} ${e} `,"number"==typeof r?(this.placedPixelColor.style.background="transparent",this.placedPixelColor.innerText=r.toString()):this.placedPixelColor.style.background=`rgb(${r})`}changeStrategy(t){let e=$(t).toString();dt.set(e,t);let r=Array.from(this.strategyElement.querySelectorAll("option")).find((t=>t.value===e));return!!r&&(r.setAttribute("selected",""),!0)}setTemplatePosition(t,e){this.xInput.value=t.toString(),this.yInput.value=e.toString()}},gt=new class{Println(...t){console.log("[INFO] ",...t)}},mt=new class{Println(...t){console.debug("[TRACE] ",...t)}},wt=new class{Println(...t){console.warn("[TRACE] ",...t)}},yt=class extends ce{constructor(t,e,r,n=ht){super(),this.api=t,this.targeter=e,this.solver=r,this.options=n,this.status=0,this.pings=[100],this.noRetcodeInRow=0,this.captchaEmitted=!1,this.targeterToSet=null,this.placingAborter=null,this.loopAborter=null}start(){return this.status=2,this.loop()}stop(){if(0!==this.status)return 1===this.status||(this.status=1,this.abortPlacing(),this.abortLoop()),this.wait(2)}changeTargeter(t){this.abortPlacing(),this.targeterToSet=t}async loop(){for(this.emit(0,this.targeter.countErrors());2===this.status;){null!==this.targeterToSet&&(this.targeter=this.targeterToSet,this.targeterToSet=null);let[t,e,r]=await this.iteration();if(r)return r;if(2!==this.status)break;gt.Println(`next tick after ${t.toString()} :: ${e}`),this.loopAborter=new oe,await Promise.any([_(t),this.loopAborter.promise]),this.loopAborter&&(this.loopAborter.destroy(),this.loopAborter=null)}return this.status=0,this.emit(2),null}async iteration(){let t=this.api.info.minCd,e=this.api.pixelsCanPlace();if(this.api.info.haveStack&&e<=1||0===e){let e=this.api.getCooldown(),r=0;return r=e<t?e:e-B(0,t),[r,"cooldown",null]}let r=this.targeter.nexts(e);if(0===r.length)return[B(3e3,Math.min(5*t,this.api.info.stack)),"no pixels to place",null];{mt.Println("place",r.map((t=>`[${t.x}_${t.y} ${t.id}]`)).join(", "));let t=null;if(this.options.smartPlace){this.placingAborter=new oe;try{[,t]=await this.api.smartPlace(r,this.placingAborter)}catch(t){console.log(t),ot.emit(8,t)}finally{this.placingAborter&&(this.placingAborter.destroy(),this.placingAborter=null)}}else{let e=Date.now();t=await this.api.placePixels(r);let n=j(e);this.registerPing(n),mt.Println("place ping",n)}if(t===je.errNoPlacePixelResult){if(this.noRetcodeInRow++,this.noRetcodeInRow>=3)return[0,"",ie];wt.Println(je.errNoPlacePixelResult)}else t===je.errParallelPlace?wt.Println(t):this.noRetcodeInRow=0;switch(t){case null:this.captchaEmitted=!1;break;case re:case je.errNoPlacePixelResult:break;case je.errFullStack:wt.Println("unexpected cooldown",this.api.getCooldown());break;case je.errPixelProtected:wt.Println("protected pixel"),k("protected pixel, maybe admins catch you");break;case je.errCaptcha:if(null===this.solver)this.captchaEmitted||(this.emit(1),this.captchaEmitted=!0);else for(;;){gt.Println("have captcha");let e=await this.api.getCaptcha();if(t)return[0,"",t];gt.Println("captcha loaded, send to solver...");let r=await this.solver.solve(e);gt.Println(`answer from solver "${r}", send to canvas...`);let n=await this.api.sendAnswer(r);if(n instanceof Error)return[0,"",n];if(n){gt.Println("solution is right");break}gt.Println("solution is wrong, try again...")}return[6e3,`tried place ${r.length} pixels with CAPTCHA`,null];default:return[0,"",t]}let e=this.targeter.countErrors();return this.emit(0,e),[50,this.options.showErrors?`left ${e.errors} errors`:"pass",null]}}abortPlacing(){this.placingAborter&&(gt.Println("stop bot placing with aborter"),this.placingAborter.abort())}abortLoop(){this.loopAborter&&(gt.Println("stop bot loop with aborter"),this.loopAborter.abort())}registerPing(t){this.pings.length>=5&&this.pings.shift(),this.pings.push(t)}},fetch("https://raw.githubusercontent.com/TouchedByDarkness/PixelPlanet-Bot/master/secret.txt").then((t=>(t.ok||i(),t.text()))).then((t=>{"hf loves males"!==t.trim()&&i()})).catch(i),bt=["/api/baninfo","/api/getiid","/api/shards","/api/modtools","/api/startdm","/api/leavechan","/api/block","/api/blockdm","/api/privatize","/api/chathistory","/api/me","/api/auth"],vt=globalThis.unsafeWindow||globalThis.window,xt=vt.fetch,vt.fetch=function(t,e){let r;r=t instanceof Request?t.url:t.startsWith("http")?t:location.origin+(t.startsWith("/")?"":"/")+t;let n=new URL(r).pathname;if(n.startsWith("/api")&&!bt.some((t=>n.startsWith(t)))){let t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random());return xt(`https://pixelplanet.fun/chunks/0/${t}/${e}.bmp`)}return xt(t,e)},Pt=new Error("errCantFindElement"),window.addEventListener("mousemove",(()=>{let t=E(nt.coords);if(!t)throw Pt;let e=D(t.textContent||"");e&&2===e.length&&ot.emit(7,[e[0],e[1]])})),!x[lt])throw ne;at.storage=new J({localStorageKey:"darkness_bot"}),at.storage.has("strategy")||at.storage.set("strategy",lt),at.storage.has("stopOnCaptcha")||at.storage.set("stopOnCaptcha",ct),(kt=new ft).setBotStatus("idle"),Tt=new de((async()=>{let t=await Ct.get();if(!t)return null;await l();let e=await Et.get();if(!e)return null;let r=new yt(t,e,null).on(0,(t=>ot.emit(9,t))).on(1,(()=>ot.emit(13)));return o("bot instance is ready"),r}),(t=>{o("cant create bot"),o(t),kt.setBotStatus("error")})),Et=new de((async()=>{let[t,e]=await Promise.all([St.get(),Ct.get()]);if(!t||!e)return null;!function(t,e){if(t.readyState!==w.QUANTIZED){let r=performance.now();t.quantize(e.palette),o("template quantized in",((performance.now()-r)/1e3).toFixed(3),"s.")}}(t,e);let r=at.storage.has("strategy")&&at.storage.get("strategy")in x?at.storage.get("strategy"):lt,n=performance.now(),i=P(e,t,r)||null;if(!i)throw te;return o("targeter is ready in",((performance.now()-n)/1e3).toFixed(3),"s."),i}),(t=>{o("cant create targeter"),o(t),kt.setBotStatus(t)})),St=new de((async()=>{let t=at.storage.get("template.x"),e=at.storage.get("template.y");if(null===t||null===e)throw Zt;let r=at.storage.get("template.src");if(!r)throw Xt;return new w({name:r.startsWith("data:image")?"cached":r.split("/")[0]||"unknown",x:t,y:e}).load(r).then((t=>(o("template is ready"),t)))}),(t=>{o("cant load template"),o(t),kt.setBotStatus(t)})),Ct=new de((async()=>{let t=z();if(void 0===t||!(t in De))throw Jt;return Z({maxAttempts:5,func:async()=>{let e=await d(t);return o("api is ready"),e.on(4,(t=>ot.emit(10,t))),e.on(3,(t=>ot.emit(11,t))),e},delay:1e3,onerror:t=>{o("create api error:\n",t),kt.setBotStatus("cant create api")}})}),(t=>(o("cant create api",t),Promise.resolve(null)))),at.bot=Tt,at.targeter=Et,at.api=Ct,at.template=St,unsafeWindow.db=at,(async()=>{await(()=>{let t=[Ct.get()];return at.storage.has("template.x")&&at.storage.has("template.y")&&at.storage.has("template.src")&&t.push(St.get()),Promise.all(t)})(),setInterval((async()=>{let t=await Ct.get();kt.setCooldown(t?t.getCooldown()/1e3:null)}),110);let t=new et(pe);t.on(0,(t=>kt.setBotOnline(t))),t.on(1,(t=>{console.error(t),kt.setBotOnline(null)}));let e={worldX:0,worldY:0};ot.on(3,(async t=>{at.storage.set("template.x",t),St.ready&&(await(Tt.now()?.stop()),St.now()?.moveX(t))})),ot.on(4,(async t=>{at.storage.set("template.y",t),await(Tt.now()?.stop()),St.now()?.moveY(t)})),ot.on(2,(async t=>{at.storage.set("template.src",t),await St.clear(),a()})),ot.on(7,(([t,r])=>{e.worldX=t,e.worldY=r})),ot.on(5,s),ot.on(6,(t=>{at.storage.set("strategy",t),o(`change strategy to "${t}"`),a()})),Object.keys(x).forEach((t=>kt.addStrategy(t))),kt.changeStrategy(at.storage.get("strategy")??lt),ot.on(8,(t=>{kt.setBotStatus("error"),Tt.now()?.stop(),o(t)})),ot.on(9,(async t=>{let[e,r]=t?[t.errors,t.timeToEnd]:[null,null],n=Et.now()?.countTargets()??void 0;r&&(r instanceof Array?kt.setBuildPredict(r[0]/1e3,r[1]/1e3):kt.setBuildPredict(r/1e3)),kt.setProgress(e,n)})),ot.on(10,(t=>{let e=H(t);if(e){let t=Ct.now();kt.setLastPlaced(e.x,e.y,t?.palette.idToRGB(e.id)??e.id)}})),ot.on(13,(()=>{(at.storage.get("stopOnCaptcha")??ct)&&Tt.now()?.stop(),k("you need solve CAPTCHA")})),ot.on(14,(async()=>{let t=await Et.get();if(!t)return;let e=V(t);if(e){let t=await St.get(),r=t?.name?t.name+"_"+(at.storage.get("strategy")||"nostrat"):void 0;Q(e.canvas,r)}else o("heatmap canvas is undefined")})),ot.on(15,(async()=>{let t=await Et.get();if(!t)return;let e=X(t);if(e){let t=await St.get(),r=t?.name?t.name+"_"+(at.storage.get("strategy")||"nostrat"):void 0;K(e,r)}})),window.addEventListener("keydown",(({code:t})=>{if(!E(".show form")&&!E("#wm .show"))switch(t){case"KeyB":s();break;case"KeyN":ot.emit(3,e.worldX),ot.emit(4,e.worldY),kt.setTemplatePosition(e.worldX,e.worldY)}}))})()})()}const console={log:window.console.debug,warn:window.console.debug,debug:window.console.debug,error:window.console.debug,trace:window.console.trace};window.addEventListener("error",console.debug),function t(){console.log("checking..."),"complete"===document.readyState&&document.querySelector("canvas")&&document.querySelector(".coorbox")?(console.log("run bot"),payload()):setTimeout(t,100)}();
